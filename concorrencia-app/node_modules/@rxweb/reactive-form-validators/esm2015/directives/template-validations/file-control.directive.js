import * as ɵngcc0 from '@angular/core';
var FileControlDirective_1;
import * as tslib_1 from "tslib";
import { Input, Directive, forwardRef, ElementRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { APP_VALIDATORS } from "../../const/app-validators.const";
const VALIDATOR_CONFIG = "validatorConfig";
const FILE_VALIDATOR_NAMES = ["extension", "fileSize", "file"];
let FileControlDirective = FileControlDirective_1 = class FileControlDirective {
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.isProcessed = false;
        this.validators = [];
        this.onChange = (_) => { };
        this.onTouched = () => { };
        this.element = elementRef.nativeElement;
    }
    onChangeCall(element) {
        let files = element.files;
        if (this.writeFile)
            this.onChange(files);
        else {
            if (files.length > 0)
                this.onChange(element.value);
            else
                this.onChange(undefined);
        }
    }
    writeValue(value) { }
    registerOnChange(invocation) { this.onChange = invocation; }
    registerOnTouched(invocation) { this.onTouched = invocation; }
    set extension(config) {
        this.pushValidator(FILE_VALIDATOR_NAMES[0], config);
    }
    set fileSize(config) {
        this.pushValidator(FILE_VALIDATOR_NAMES[1], config);
    }
    set file(config) {
        this.pushValidator(FILE_VALIDATOR_NAMES[2], config);
    }
    setConfig(control) {
        FILE_VALIDATOR_NAMES.forEach(t => {
            if (!this[t] && control[VALIDATOR_CONFIG] && control[VALIDATOR_CONFIG][t])
                this[t] = control[VALIDATOR_CONFIG][t];
        });
        this.isProcessed = true;
    }
    pushValidator(validatorName, config) {
        if (config)
            this.validators.push(APP_VALIDATORS[validatorName](config));
    }
    validate(control) {
        if (!this.isProcessed)
            this.setConfig(control);
        var result = null;
        for (var validator of this.validators) {
            result = validator(control, this.element.files);
            if (result)
                break;
        }
        return result;
    }
};
FileControlDirective.ɵfac = function FileControlDirective_Factory(t) { return new (t || FileControlDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
FileControlDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FileControlDirective, selectors: [["input", "type", "file"]], hostBindings: function FileControlDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("change", function FileControlDirective_change_HostBindingHandler($event) { return ctx.onChangeCall($event.target); })("blur", function FileControlDirective_blur_HostBindingHandler() { return ctx.onTouched(); });
    } }, inputs: { extension: "extension", fileSize: "fileSize", file: "file", writeFile: "writeFile" }, features: [ɵngcc0.ɵɵProvidersFeature([{ provide: NG_VALUE_ACCESSOR, useExisting: FileControlDirective_1, multi: true }, {
                provide: NG_VALIDATORS,
                useExisting: forwardRef(() => FileControlDirective_1),
                multi: true
            }])] });
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean)
], FileControlDirective.prototype, "writeFile", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object),
    tslib_1.__metadata("design:paramtypes", [Object])
], FileControlDirective.prototype, "extension", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object),
    tslib_1.__metadata("design:paramtypes", [Object])
], FileControlDirective.prototype, "fileSize", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object),
    tslib_1.__metadata("design:paramtypes", [Object])
], FileControlDirective.prototype, "file", null);
FileControlDirective = FileControlDirective_1 = tslib_1.__decorate([ tslib_1.__metadata("design:paramtypes", [ElementRef])
], FileControlDirective);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileControlDirective, [{
        type: Directive,
        args: [{
                selector: "input[type=file]",
                host: {
                    "(change)": "onChangeCall($event.target)",
                    "(blur)": "onTouched()"
                },
                providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: FileControlDirective_1, multi: true }, {
                        provide: NG_VALIDATORS,
                        useExisting: forwardRef(() => FileControlDirective_1),
                        multi: true
                    }]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { extension: [{
            type: Input
        }], fileSize: [{
            type: Input
        }], file: [{
            type: Input
        }], writeFile: [{
            type: Input
        }] }); })();
export { FileControlDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1jb250cm9sLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiQHJ4d2ViL3JlYWN0aXZlLWZvcm0tdmFsaWRhdG9ycy9kaXJlY3RpdmVzL3RlbXBsYXRlLXZhbGlkYXRpb25zL2ZpbGUtY29udHJvbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RSxPQUFPLEVBQW1CLGFBQWEsRUFBYSxpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNsRSxNQUFNLGdCQUFnQixHQUFHLGlCQUFpQixDQUFDO0FBQzNDLE1BQU0sb0JBQW9CLEdBQWEsQ0FBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBYXpFLElBQWEsb0JBQW9CLDRCQUFqQyxNQUFhLG9CQUFvQjtBQUFHLElBdUNoQyxZQUFvQixVQUFzQjtBQUM5QyxRQUR3QixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFwQzNDLGdCQUFXLEdBQVksS0FBSyxDQUFDO0FBQ2pDLFFBRVksZUFBVSxHQUFlLEVBQUUsQ0FBQztBQUN4QyxRQUNJLGFBQVEsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLFFBQUksY0FBUyxHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUMxQixRQThCUSxJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQyxhQUFxQixDQUFDO0FBQ3hELElBQUksQ0FBQztBQUNMLElBL0JJLFlBQVksQ0FBQyxPQUF5QjtBQUMxQyxRQUFRLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7QUFDbEMsUUFBUSxJQUFJLElBQUksQ0FBQyxTQUFTO0FBQzFCLFlBQVksSUFBSSxDQUFDLFFB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QSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQTlCQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBTUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBeENBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFyQ0EsQUFBQSxBQVpBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUF3Q0EsQUFBQSxBQXZDQSxBQUFBLEFBbUVBLEFBbkVBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbnB1dCwgRGlyZWN0aXZlLCBmb3J3YXJkUmVmLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgTkdfVkFMSURBVE9SUywgVmFsaWRhdG9yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRXh0ZW5zaW9uQ29uZmlnLCBTaXplQ29uZmlnLCBGaWxlQ29uZmlnIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2NvbmZpZydcclxuaW1wb3J0IHsgQVBQX1ZBTElEQVRPUlMgfSBmcm9tIFwiLi4vLi4vY29uc3QvYXBwLXZhbGlkYXRvcnMuY29uc3RcIjtcclxuY29uc3QgVkFMSURBVE9SX0NPTkZJRyA9IFwidmFsaWRhdG9yQ29uZmlnXCI7XHJcbmNvbnN0IEZJTEVfVkFMSURBVE9SX05BTUVTOiBzdHJpbmdbXSA9IFtcImV4dGVuc2lvblwiLCBcImZpbGVTaXplXCIsIFwiZmlsZVwiXTtcclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogXCJpbnB1dFt0eXBlPWZpbGVdXCIsXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgXCIoY2hhbmdlKVwiOiBcIm9uQ2hhbmdlQ2FsbCgkZXZlbnQudGFyZ2V0KVwiLFxyXG4gICAgICAgIFwiKGJsdXIpXCI6IFwib25Ub3VjaGVkKClcIlxyXG4gICAgfSxcclxuICAgIHByb3ZpZGVyczogW3sgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBGaWxlQ29udHJvbERpcmVjdGl2ZSwgbXVsdGk6IHRydWUgfSwge1xyXG4gICAgICAgIHByb3ZpZGU6IE5HX1ZBTElEQVRPUlMsXHJcbiAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRmlsZUNvbnRyb2xEaXJlY3RpdmUpLFxyXG4gICAgICAgIG11bHRpOiB0cnVlXHJcbiAgICB9XVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsZUNvbnRyb2xEaXJlY3RpdmUgaW1wbGVtZW50cyBWYWxpZGF0b3Ige1xyXG4gICAgZmlsZXM6IGFueTtcclxuICAgIGVsZW1lbnQ6IGFueVxyXG4gICAgaXNQcm9jZXNzZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIFxyXG5cclxuICAgIHByaXZhdGUgdmFsaWRhdG9yczogRnVuY3Rpb25bXSA9IFtdO1xyXG5cclxuICAgIG9uQ2hhbmdlID0gKF8pID0+IHsgfTtcclxuICAgIG9uVG91Y2hlZCA9ICgpID0+IHsgfTtcclxuXHJcbiAgICBvbkNoYW5nZUNhbGwoZWxlbWVudDogSFRNTElucHV0RWxlbWVudCkge1xyXG4gICAgICAgIGxldCBmaWxlcyA9IGVsZW1lbnQuZmlsZXM7XHJcbiAgICAgICAgaWYgKHRoaXMud3JpdGVGaWxlKVxyXG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKGZpbGVzKTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKGVsZW1lbnQudmFsdWUpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsdWUpIHsgfVxyXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShpbnZvY2F0aW9uOiBhbnkpIHsgdGhpcy5vbkNoYW5nZSA9IGludm9jYXRpb247IH1cclxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGludm9jYXRpb246IGFueSkgeyB0aGlzLm9uVG91Y2hlZCA9IGludm9jYXRpb247IH1cclxuXHJcbiAgICBASW5wdXQoKSB3cml0ZUZpbGU6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBzZXQgZXh0ZW5zaW9uKGNvbmZpZzogRXh0ZW5zaW9uQ29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5wdXNoVmFsaWRhdG9yKEZJTEVfVkFMSURBVE9SX05BTUVTWzBdLCBjb25maWcpXHJcbiAgICB9XHJcbiAgICBASW5wdXQoKSBzZXQgZmlsZVNpemUoY29uZmlnOiBTaXplQ29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5wdXNoVmFsaWRhdG9yKEZJTEVfVkFMSURBVE9SX05BTUVTWzFdLCBjb25maWcpXHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCkgc2V0IGZpbGUoY29uZmlnOiBGaWxlQ29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5wdXNoVmFsaWRhdG9yKEZJTEVfVkFMSURBVE9SX05BTUVTWzJdLCBjb25maWcpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIE5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q29uZmlnKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCkge1xyXG4gICAgICAgIEZJTEVfVkFMSURBVE9SX05BTUVTLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpc1t0XSAmJiBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddICYmIGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR11bdF0pXHJcbiAgICAgICAgICAgICAgICB0aGlzW3RdID0gY29udHJvbFtWQUxJREFUT1JfQ09ORklHXVt0XTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMuaXNQcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1c2hWYWxpZGF0b3IodmFsaWRhdG9yTmFtZTogc3RyaW5nLCBjb25maWc6IEV4dGVuc2lvbkNvbmZpZyB8IFNpemVDb25maWcgfCBGaWxlQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKGNvbmZpZylcclxuICAgICAgICAgICAgdGhpcy52YWxpZGF0b3JzLnB1c2goQVBQX1ZBTElEQVRPUlNbdmFsaWRhdG9yTmFtZV0oY29uZmlnKSlcclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNQcm9jZXNzZWQpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q29uZmlnKGNvbnRyb2wpO1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBudWxsO1xyXG4gICAgICAgIGZvciAodmFyIHZhbGlkYXRvciBvZiB0aGlzLnZhbGlkYXRvcnMpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gdmFsaWRhdG9yKGNvbnRyb2wsIHRoaXMuZWxlbWVudC5maWxlcyk7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgfVxyXG59XHJcbiJdfQ==