import * as tslib_1 from "tslib";
import { Input, Directive, forwardRef, ElementRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { APP_VALIDATORS } from "../../const/app-validators.const";
import * as ɵngcc0 from '@angular/core';
var VALIDATOR_CONFIG = "validatorConfig";
var FILE_VALIDATOR_NAMES = ["extension", "fileSize", "file"];
var FileControlDirective = /** @class */ (function () {
    function FileControlDirective(elementRef) {
        this.elementRef = elementRef;
        this.isProcessed = false;
        this.validators = [];
        this.onChange = function (_) { };
        this.onTouched = function () { };
        this.element = elementRef.nativeElement;
    }
    FileControlDirective_1 = FileControlDirective;
    FileControlDirective.prototype.onChangeCall = function (element) {
        var files = element.files;
        if (this.writeFile)
            this.onChange(files);
        else {
            if (files.length > 0)
                this.onChange(element.value);
            else
                this.onChange(undefined);
        }
    };
    FileControlDirective.prototype.writeValue = function (value) { };
    FileControlDirective.prototype.registerOnChange = function (invocation) { this.onChange = invocation; };
    FileControlDirective.prototype.registerOnTouched = function (invocation) { this.onTouched = invocation; };
    Object.defineProperty(FileControlDirective.prototype, "extension", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[0], config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileControlDirective.prototype, "fileSize", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[1], config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileControlDirective.prototype, "file", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[2], config);
        },
        enumerable: true,
        configurable: true
    });
    FileControlDirective.prototype.setConfig = function (control) {
        var _this = this;
        FILE_VALIDATOR_NAMES.forEach(function (t) {
            if (!_this[t] && control[VALIDATOR_CONFIG] && control[VALIDATOR_CONFIG][t])
                _this[t] = control[VALIDATOR_CONFIG][t];
        });
        this.isProcessed = true;
    };
    FileControlDirective.prototype.pushValidator = function (validatorName, config) {
        if (config)
            this.validators.push(APP_VALIDATORS[validatorName](config));
    };
    FileControlDirective.prototype.validate = function (control) {
        var e_1, _a;
        if (!this.isProcessed)
            this.setConfig(control);
        var result = null;
        try {
            for (var _b = tslib_1.__values(this.validators), _c = _b.next(); !_c.done; _c = _b.next()) {
                var validator = _c.value;
                result = validator(control, this.element.files);
                if (result)
                    break;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return result;
    };
    var FileControlDirective_1;
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], FileControlDirective.prototype, "writeFile", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], FileControlDirective.prototype, "extension", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], FileControlDirective.prototype, "fileSize", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], FileControlDirective.prototype, "file", null);
    FileControlDirective = FileControlDirective_1 = tslib_1.__decorate([ tslib_1.__metadata("design:paramtypes", [ElementRef])
    ], FileControlDirective);
FileControlDirective.ɵfac = function FileControlDirective_Factory(t) { return new (t || FileControlDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
FileControlDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FileControlDirective, selectors: [["input", "type", "file"]], hostBindings: function FileControlDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("change", function FileControlDirective_change_HostBindingHandler($event) { return ctx.onChangeCall($event.target); })("blur", function FileControlDirective_blur_HostBindingHandler() { return ctx.onTouched(); });
    } }, inputs: { extension: "extension", fileSize: "fileSize", file: "file", writeFile: "writeFile" }, features: [ɵngcc0.ɵɵProvidersFeature([{ provide: NG_VALUE_ACCESSOR, useExisting: FileControlDirective_1, multi: true }, {
                provide: NG_VALIDATORS,
                useExisting: forwardRef(function () { return FileControlDirective_1; }),
                multi: true
            }])] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileControlDirective, [{
        type: Directive,
        args: [{
                selector: "input[type=file]",
                host: {
                    "(change)": "onChangeCall($event.target)",
                    "(blur)": "onTouched()"
                },
                providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: FileControlDirective_1, multi: true }, {
                        provide: NG_VALIDATORS,
                        useExisting: forwardRef(function () { return FileControlDirective_1; }),
                        multi: true
                    }]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { extension: [{
            type: Input
        }], fileSize: [{
            type: Input
        }], file: [{
            type: Input
        }], writeFile: [{
            type: Input
        }] }); })();
    return FileControlDirective;
}());
export { FileControlDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1jb250cm9sLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiQHJ4d2ViL3JlYWN0aXZlLWZvcm0tdmFsaWRhdG9ycy9kaXJlY3RpdmVzL3RlbXBsYXRlLXZhbGlkYXRpb25zL2ZpbGUtY29udHJvbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekUsT0FBTyxFQUFtQixhQUFhLEVBQWEsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7O0FBQ2xFLElBQU0sZ0JBQWdCLEdBQUcsaUJBQWlCLENBQUM7QUFDM0MsSUFBTSxvQkFBb0IsR0FBYSxDQUFDLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFhekU7QUFBd0QsSUF1Q3BELDhCQUFvQixVQUFzQjtBQUM5QyxRQUR3QixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFwQzNDLGdCQUFXLEdBQVksS0FBSyxDQUFDO0FBQ2pDLFFBRVksZUFBVSxHQUFlLEVBQUUsQ0FBQztBQUN4QyxRQUNJLGFBQVEsR0FBRyxVQUFDLENBQUMsSUFBTyxDQUFDLENBQUM7QUFDMUIsUUFBSSxjQUFTLEdBQUcsY0FBUSxDQUFDLENBQUM7QUFDMUIsUUE4QlEsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsYUFBcUIsQ0FBQztBQUN4RCxJQUFJLENBQUM7QUFDTCw2QkExQ2Esb0JBQW9CO0FBQUUsSUFXL0IsMkNBQVksR0FBWixVQUFhLE9BQXlCO0FBQzFDLFFBQVEsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztBQUNsQyxRQUFRLElBQUksSUFBSSxDQUFDLFNBQVM7QUFDMUIsWUFBWSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FB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QSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWFBLEFBdUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFwQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBK0JBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUF6Q0EsQUFBQSxBQVdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQU1BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU1BLEFBTEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUF2Q0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQXJDQSxBQUFBLEFBWkEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBd0NBLEFBQUEsQUF2Q0EsQUFBQSxBQW1FQSxBQUFBLEFBQUEsQUFBQSxBQW5FQSxBQW1FQSxBQW5FQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXQsIERpcmVjdGl2ZSwgZm9yd2FyZFJlZiwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIE5HX1ZBTElEQVRPUlMsIFZhbGlkYXRvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEV4dGVuc2lvbkNvbmZpZywgU2l6ZUNvbmZpZywgRmlsZUNvbmZpZyB9IGZyb20gJy4uLy4uL21vZGVscy9jb25maWcnXHJcbmltcG9ydCB7IEFQUF9WQUxJREFUT1JTIH0gZnJvbSBcIi4uLy4uL2NvbnN0L2FwcC12YWxpZGF0b3JzLmNvbnN0XCI7XHJcbmNvbnN0IFZBTElEQVRPUl9DT05GSUcgPSBcInZhbGlkYXRvckNvbmZpZ1wiO1xyXG5jb25zdCBGSUxFX1ZBTElEQVRPUl9OQU1FUzogc3RyaW5nW10gPSBbXCJleHRlbnNpb25cIiwgXCJmaWxlU2l6ZVwiLCBcImZpbGVcIl07XHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6IFwiaW5wdXRbdHlwZT1maWxlXVwiLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgIFwiKGNoYW5nZSlcIjogXCJvbkNoYW5nZUNhbGwoJGV2ZW50LnRhcmdldClcIixcclxuICAgICAgICBcIihibHVyKVwiOiBcIm9uVG91Y2hlZCgpXCJcclxuICAgIH0sXHJcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLCB1c2VFeGlzdGluZzogRmlsZUNvbnRyb2xEaXJlY3RpdmUsIG11bHRpOiB0cnVlIH0sIHtcclxuICAgICAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZpbGVDb250cm9sRGlyZWN0aXZlKSxcclxuICAgICAgICBtdWx0aTogdHJ1ZVxyXG4gICAgfV1cclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbGVDb250cm9sRGlyZWN0aXZlIGltcGxlbWVudHMgVmFsaWRhdG9yIHtcclxuICAgIGZpbGVzOiBhbnk7XHJcbiAgICBlbGVtZW50OiBhbnlcclxuICAgIGlzUHJvY2Vzc2VkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBcclxuXHJcbiAgICBwcml2YXRlIHZhbGlkYXRvcnM6IEZ1bmN0aW9uW10gPSBbXTtcclxuXHJcbiAgICBvbkNoYW5nZSA9IChfKSA9PiB7IH07XHJcbiAgICBvblRvdWNoZWQgPSAoKSA9PiB7IH07XHJcblxyXG4gICAgb25DaGFuZ2VDYWxsKGVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBsZXQgZmlsZXMgPSBlbGVtZW50LmZpbGVzO1xyXG4gICAgICAgIGlmICh0aGlzLndyaXRlRmlsZSlcclxuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZShmaWxlcyk7XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZShlbGVtZW50LnZhbHVlKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSh1bmRlZmluZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbHVlKSB7IH1cclxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoaW52b2NhdGlvbjogYW55KSB7IHRoaXMub25DaGFuZ2UgPSBpbnZvY2F0aW9uOyB9XHJcbiAgICByZWdpc3Rlck9uVG91Y2hlZChpbnZvY2F0aW9uOiBhbnkpIHsgdGhpcy5vblRvdWNoZWQgPSBpbnZvY2F0aW9uOyB9XHJcblxyXG4gICAgQElucHV0KCkgd3JpdGVGaWxlOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgc2V0IGV4dGVuc2lvbihjb25maWc6IEV4dGVuc2lvbkNvbmZpZykge1xyXG4gICAgICAgIHRoaXMucHVzaFZhbGlkYXRvcihGSUxFX1ZBTElEQVRPUl9OQU1FU1swXSwgY29uZmlnKVxyXG4gICAgfVxyXG4gICAgQElucHV0KCkgc2V0IGZpbGVTaXplKGNvbmZpZzogU2l6ZUNvbmZpZykge1xyXG4gICAgICAgIHRoaXMucHVzaFZhbGlkYXRvcihGSUxFX1ZBTElEQVRPUl9OQU1FU1sxXSwgY29uZmlnKVxyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIHNldCBmaWxlKGNvbmZpZzogRmlsZUNvbmZpZykge1xyXG4gICAgICAgIHRoaXMucHVzaFZhbGlkYXRvcihGSUxFX1ZBTElEQVRPUl9OQU1FU1syXSwgY29uZmlnKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBOb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENvbmZpZyhjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpIHtcclxuICAgICAgICBGSUxFX1ZBTElEQVRPUl9OQU1FUy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXNbdF0gJiYgY29udHJvbFtWQUxJREFUT1JfQ09ORklHXSAmJiBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddW3RdKVxyXG4gICAgICAgICAgICAgICAgdGhpc1t0XSA9IGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR11bdF07XHJcbiAgICAgICAgfSlcclxuICAgICAgICB0aGlzLmlzUHJvY2Vzc2VkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdXNoVmFsaWRhdG9yKHZhbGlkYXRvck5hbWU6IHN0cmluZywgY29uZmlnOiBFeHRlbnNpb25Db25maWcgfCBTaXplQ29uZmlnIHwgRmlsZUNvbmZpZykge1xyXG4gICAgICAgIGlmIChjb25maWcpXHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdG9ycy5wdXNoKEFQUF9WQUxJREFUT1JTW3ZhbGlkYXRvck5hbWVdKGNvbmZpZykpXHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGUoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUHJvY2Vzc2VkKVxyXG4gICAgICAgICAgICB0aGlzLnNldENvbmZpZyhjb250cm9sKTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcclxuICAgICAgICBmb3IgKHZhciB2YWxpZGF0b3Igb2YgdGhpcy52YWxpZGF0b3JzKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHZhbGlkYXRvcihjb250cm9sLCB0aGlzLmVsZW1lbnQuZmlsZXMpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgIH1cclxufVxyXG4iXX0=